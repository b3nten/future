(()=>{function r(t){return typeof t=="function"}function d(t){return!!(t instanceof o||t instanceof Promise||typeof t=="object"&&t&&"then"in t&&r(t.then))}var o=class t{constructor(e,{lazy:s}={lazy:!0}){this.#l=e,this.#e="pending",this.#i=void 0,this.#s=void 0,s||(this.#t=this.#c())}#l;#e;#i;#s;#t;#r;#o;#n;#u=[];#c(){let e=new Promise((s,u)=>{this.#r=s,this.#o=u});return this.#n=this.#l(this.resolve,this.reject),e}#d(e){this.#e==="pending"&&(this.#i=e,this.#e="resolved",this.#r?this.#r(e):this.#t=Promise.resolve(e),r(this.#n)&&this.#n())}#h(e){this.#e==="pending"&&(this.#s=e,this.#e="rejected",this.#o?this.#o(e):this.#t=Promise.reject(e),r(this.#n)&&this.#n())}#a(){this.#e==="pending"&&this.#h("Cancelled"),this.#e="cancelled",this.#u.forEach(e=>e.cancel())}get status(){return this.#e}get value(){return this.#i}get rejection(){return this.#s}get pending(){return this.#e==="pending"}get rejected(){return this.#e==="rejected"}get resolved(){return this.#e==="resolved"}resolve=e=>{this.#d(e)};reject=e=>{this.#h(e)};cancel=()=>{this.#a()};begin=()=>(this.#t||(this.#t=this.#c()),this);then=(e,s)=>{this.#t||(this.#t=this.#c());let u,l,c;r(e)&&(u=n=>{let i=e(n);return d(i)&&(c=i),n}),r(s)&&(l=n=>{let i=s(n);return d(i)&&(c=i),n});let a=this.#t.then(u,l),h=new t((n,i)=>{a.then(n,i)},{lazy:!1});return c&&this.#u.push(c),this.#u.push(h),h};catch=e=>this.then(void 0,e)},f=new o((t,e)=>{setTimeout(()=>{console.log("Resolving first future"),t("hello world")},1e3)}).then(async t=>(await new Promise(e=>setTimeout(e,1e3)),console.log("Resolving second future"),t)).then(t=>{console.log("result in third future",t)}).catch(t=>(console.log("catch",t),t));setTimeout(()=>{f.cancel()},1500);})();
